# ==============================================================================
# Use Case 1: Fixed Backbone Sequence Redesign (Fixbb)
# ==============================================================================
# Finds a sequence that maximizes folding propensity for a specific backbone.
#
# Reference: Stephen Rettie et al., doi: https://doi.org/10.1101/2023.02.25.529956
#
# When to use:
#   - You have a target backbone structure (e.g., from Rosetta)
#   - Want to find the optimal amino acid sequence for that backbone
#   - Redesigning existing cyclic peptide scaffolds
#
# Key features:
#   - Input: Target backbone structure in PDB format
#   - Loss: Categorical cross-entropy (CCE) between target and predicted distograms
#   - 3-stage optimization: 110 steps total (50 + 50 + 10)
#   - Transitions from continuous logits to one-hot encoding
# ==============================================================================

name: "fixbb_sequence_design"
description: "Redesign sequence for fixed cyclic peptide backbone (Use Case 1)"

# ------------------------------------------------------------------------------
# Input: Target backbone structure in PDB format
# ------------------------------------------------------------------------------
# Examples from paper: Rosetta-generated backbones like RRR13.1
# ------------------------------------------------------------------------------
input:
  pdb_file: "data/test_backbone.pdb"  # Target backbone PDB file
  chain: "A"                           # Chain ID to use

# ------------------------------------------------------------------------------
# Optimization Parameters (from paper)
# ------------------------------------------------------------------------------
# 110-step schedule:
#   Stage 1 (50 steps): Optimize continuous logits representation
#   Stage 2 (50 steps): Soft optimization with softmax
#   Stage 3 (10 steps): Hard optimization with straight-through estimator
# ------------------------------------------------------------------------------
optimization:
  # Three-stage design schedule
  stage_1_iters: 50                # Stage 1: logits optimization
  stage_2_iters: 50                # Stage 2: soft optimization
  stage_3_iters: 10                # Stage 3: hard optimization (one-hot)

  # Combined stage_iters for compatibility
  stage_iters: [50, 50, 10]        # [logits, soft, hard] iterations

  # Loss function: CCE between target and predicted distogram
  loss_type: "cce"                 # Categorical cross-entropy loss

  # Optimizer settings
  # Start from continuous representation (logits) and transition to one-hot
  # using straight-through estimator in the final stage
  use_straight_through: true       # Enable straight-through estimator

# ------------------------------------------------------------------------------
# Cyclic Constraints
# ------------------------------------------------------------------------------
constraints:
  offset_type: 2                   # Signed cyclic offset for head-to-tail
  add_rg: false                    # Optional: add radius of gyration loss
  rg_weight: 0.1                   # Weight for Rg loss (if enabled)

# ------------------------------------------------------------------------------
# Workflow (from paper):
#   1. Extract distogram from target PDB
#   2. Initialize with random sequence
#   3. Iteratively optimize sequence to minimize CCE loss
# ------------------------------------------------------------------------------

# Sequence constraints
sequence:
  exclude_amino_acids: "C"         # Exclude cysteine to avoid disulfides
  # positions: "1-5,10-15"         # Optional: redesign only specific positions

# AlphaFold settings
alphafold:
  num_recycles: 0                  # Recycles during optimization (0 is faster)
  num_models: 1                    # Number of models to use

# Output settings
output:
  save_metadata: true
  save_trajectory: false           # Save intermediate structures

# GPU settings
gpu:
  device: 0
  mem_fraction: 0.9
