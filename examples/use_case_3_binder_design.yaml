# ==============================================================================
# Use Case 3: Peptide Binder Design (Motif Grafting)
# ==============================================================================
# Designs cyclic peptide binders for protein targets like MDM2 or Keap1.
# This is the most complex workflow combining multiple tools and filtering steps.
#
# Reference: Stephen Rettie et al., doi: https://doi.org/10.1101/2023.02.25.529956
#
# When to use:
#   - Designing therapeutic cyclic peptide binders
#   - Targeting protein-protein interaction interfaces
#   - Drug discovery campaigns against specific targets
#
# Key features:
#   - Input: Target protein PDB, binding motif, scaffold library
#   - Uses Rosetta MotifGraft with 1.0 A RMSD tolerance
#   - 3-4 rounds of ProteinMPNN + Rosetta energy minimization
#   - Comprehensive filtering: iPAE, ddG, SAP, CMS metrics
# ==============================================================================

name: "cyclic_binder_design"
description: "Design cyclic peptide binders for protein targets (Use Case 3)"

# ------------------------------------------------------------------------------
# Input Files (from paper)
# ------------------------------------------------------------------------------
# Target Protein PDB: e.g., MDM2 (4HFZ), Keap1 (2FLU)
# Binding Motif: Short functional segments (p53: FSDLW, Nrf2: DEETGE)
# Scaffold Library: ~24,000 hallucinated high-confidence cyclic peptides
# ------------------------------------------------------------------------------
input:
  target_pdb: "data/structures/1O91.pdb"  # Target protein structure
  target_chain: "A"                        # Target chain ID

  # Binding motif (optional - for motif grafting workflow)
  # motif_sequence: "FSDLW"               # Functional motif to graft
  # motif_positions: null                  # Positions in scaffold to place motif

  # Scaffold library (optional - for motif grafting)
  # scaffold_library: "scaffolds/"        # Directory of hallucinated scaffolds

# ------------------------------------------------------------------------------
# Binder Design Parameters
# ------------------------------------------------------------------------------
binder:
  length: 14                       # Binder peptide length
  # initial_sequence: null         # Optional starting sequence

  # Hotspot residues on target (restrict binding site)
  # Example: "20-30,45-50" for specific interface residues
  hotspot: null                    # Target hotspot residues (optional)

# ------------------------------------------------------------------------------
# Grafting Parameters (from paper)
# ------------------------------------------------------------------------------
# Uses Rosetta MotifGraft with strict RMSD tolerance
# ------------------------------------------------------------------------------
grafting:
  enabled: false                   # Enable motif grafting workflow
  rmsd_tolerance: 1.0              # RMSD tolerance in Angstroms

# ------------------------------------------------------------------------------
# Sequence Design Parameters (from paper)
# ------------------------------------------------------------------------------
# 3-4 iterative rounds of ProteinMPNN + Rosetta minimization
# ------------------------------------------------------------------------------
sequence_design:
  # Optimizer selection
  optimizer: "pssm_semigreedy"     # Options: pssm_semigreedy, 3stage, pssm, soft, hard

  # For ProteinMPNN-based design (if using external pipeline)
  proteinmpnn_rounds: 3            # Number of ProteinMPNN iterations

  # Rosetta energy minimization
  rosetta_scorefunction: "REF2015" # Rosetta score function

# ------------------------------------------------------------------------------
# AfCycDesign Prediction Parameters
# ------------------------------------------------------------------------------
# Apply cyclic offset ONLY to the binder chain (not the target)
# ------------------------------------------------------------------------------
prediction:
  num_recycles: 0                  # AF2 recycles during design
  num_models: 2                    # Number of AF2 models

  # Cyclic constraint applies only to binder
  offset_type: 2                   # Signed cyclic offset
  cyclic_binder_only: true         # Apply cyclic offset only to binder chain

# ------------------------------------------------------------------------------
# Filtering Metrics (from paper)
# ------------------------------------------------------------------------------
# iPAE (Interface PAE): < 0.11 or 0.15
# ddG: < -30 kcal/mol
# SAP score: < 30
# CMS (Contact Molecular Surface): > 300
# Binding mode RMSD: < 1.5 A
# ------------------------------------------------------------------------------
filtering:
  # Interface PAE threshold
  ipae_threshold: 0.15             # iPAE < 0.15 (or 0.11 for strict)

  # Rosetta metrics
  ddg_threshold: -30.0             # ddG < -30 kcal/mol
  sap_threshold: 30.0              # SAP score < 30
  cms_threshold: 300.0             # CMS > 300

  # Structural validation
  rmsd_threshold: 1.5              # Binding mode RMSD < 1.5 A

# ------------------------------------------------------------------------------
# Workflow (from paper):
#   1. Graft functional motif onto stable hallucinated scaffolds
#   2. Redesign non-motif residues using ProteinMPNN
#   3. Use AfCycDesign to predict target-peptide complex
#      (cyclic offset only on binder chain)
#   4. Verify binding mode via iPAE and RMSD < 1.5 A
# ------------------------------------------------------------------------------

# AlphaFold settings
alphafold:
  use_multimer: false              # Use AlphaFold-multimer
  target_flexible: false           # Allow target backbone flexibility
  dropout: true                    # Enable dropout during design

# Optimization stages
optimization:
  stage_iters: [120, 60, 10]       # Design iterations for 3-stage
  pssm_iters: 120                  # PSSM optimization iterations
  semigreedy_iters: 32             # Semigreedy iterations

# Output settings
output:
  save_metadata: true
  save_pssm: true                  # Save position-specific scoring matrix

# GPU settings
gpu:
  device: 0
  mem_fraction: 0.9
